<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.airbnb.airbnb_service.mapper.JyTempMapper">
    <select id="selectSearchHouseList" resultType="com.airbnb.airbnb_service.data.MainViewResponse">
        select a.*,
                IFNULL(b.wish,0) as wish,
                IFNULL(c.cate_bar_place,0) as cate_bar_place,        
                IFNULL(bi.booking,0) as booking
        from main_search_view a
        left join (
                select wish_hi_seq, 1 as wish from wish_info wi where wish_mi_seq = #{user_seq}
                )b
                on a.hi_seq = b.wish_hi_seq
        left join (
                select hpi_hi_seq, 1 as cate_bar_place
                from house_place_info hpi 
                where hpi_cp_seq = #{cate_place}
                group by hpi_hi_seq 
                )c
                on a.hi_seq = c.hpi_hi_seq
        left join (
                select bi_hi_seq, count(*) as booking from booking_info
                where date(bi_start_dt) BETWEEN #{in_dt} AND #{out_dt}
                or (#{out_dt} BETWEEN date(bi_start_dt) AND date(bi_end_dt))
                group by bi_hi_seq
                )bi
            on a.hi_seq = bi.bi_hi_seq
        left join (
            select * from house_amenity_info ham
            where 
                ham_ca_seq = #{amenity}
            group by ham_hi_seq
        )ham
        on a.hi_seq = ham.ham_hi_seq
        left join (
                select * from member_lang_info mli 
                where 
                    ml_cl_seq = #{lang}
                group by mli_mi_seq 
                )mli
        on a.hi_mi_seq = mli_mi_seq
        where 
            (country like concat('%','','%') or city like concat('%','','%') or address like concat('%','','%'))
        and guest >= #{guest}
        and dog = #{dog}
        and price between #{min} and #{max}
        and hi_type = #{type}
        and bed >= #{bed}
        and bedroom >= #{bedroom}
        and bathroom >= #{bathroom}
        and super_host = #{superhost}

    </select>

    
    <select id="selectCategoryAmenityList" resultType="com.airbnb.airbnb_service.data.category.CategoryAmenityVO">
            SELECT ca_seq, ca_type, ca_content, ca_icon
            FROM category_amenity
    </select>
    
    <select id="selectCategoryLangList" resultType="com.airbnb.airbnb_service.data.category.CategoryLangVO">
            SELECT cl_seq, cl_content
            FROM category_lang;
    </select>




</mapper>